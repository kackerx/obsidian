# GC流程和调优

& GC的流程
- GCMark标记准备阶段, 为并发标记做准备工作, 启动写屏障
- STWGCMark扫描标记阶段, 与赋值器并发执行, 写屏障开启并发
- GCMarkTermination标记终止阶段, 保证一个周期内标记任务完成, 停止写屏障
- GCoff内存清扫阶段, 将需要回收的内存归还堆中, 写屏障关闭
- GCoff内存归还阶段, 将过多的内存归还给Os, 写屏障关闭

& GC的调优
- 通过go tool pprof和go tool trace
- 控制内存分配速度, 限制goro数量, 提高赋值器对CPU的利用率
- 减少并复用内存, 例如用sync.Pool来复用需要频繁创建临时对象, 例如提前分配足够的内存来降低多余的拷贝
- 需要时, 增打GOGC的值, 降低gc运行的频率
