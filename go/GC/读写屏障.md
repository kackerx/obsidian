# 读写屏障
![[Pasted image 20221112103420.png|200]]
- 如上图, 在遍历第三步的灰色集合中, 扫描a, 标记bc, 然后扫描d时, 有goro把d的e的引用给了a, 此时e会被当成垃圾, 写屏障解决

![[Pasted image 20221112205922.png|700]]
- 实现强弱三色不变式是通过写屏障, 写屏障既是记录对对象的操作到一个表
- 强三色不变式: 不允许黑色指向白色对象, 因为黑色对象不会被再次追踪, 白色误判为垃圾
    - 实现方式是插入写屏障, 是指, 当黑色指向白色时, 把指向的白色进化为灰色, 或者把黑色退化为灰色
- 弱三色不变式: 允许黑色指向白色, 但也要有灰色指向该白色
    - 实现方式是删除写屏障, 是指, 当灰色对有黑色引用的白色断开时(c=nil), 把白色着为灰色

- 回收器已经把对象A复制到to空间, 但是用户程序的B对象后续引用了From空间的旧对象, Form空间被回收, B的指向出错
    - 实现方式是读屏障, 检测到引用对象读取产生了新副本A时, 转而读取to空间的新副本