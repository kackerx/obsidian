# RWMutex

## 实现

- 通过记录readerCount读锁的数量控制, 当有写锁的时候, 读锁数量设置为1 << 30(负数), 让新进的读锁等待写锁释放通知读锁
- 当有写锁抢占时, 也会等待之前的读锁释放完毕
- 写锁释放完毕后将值加上1 << 30通知新进入的读锁

## 注意事项

- 单写多读, 多个读锁, 一个写锁
- 多个goro可以同时获取读锁
- 写锁阻止其他goro无论读还是写, 适用于读多写少
- 零值是一个未锁定状态的互斥锁
- 读锁和写锁在未锁定状态, 解锁都会触发panic
- 写锁被释放后, 所有因此被阻塞的读锁会被唤醒, 成功拿到读锁
- 读锁被释放后, 所以因此被阻塞的写锁的goro等待时间最长的一个被唤醒