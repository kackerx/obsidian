# 数据页 & 数据记录
## 数据页

![[Pasted image 20230321182205.png|555]]
- 磁盘文件内多个数据页之间通过双向链表链接(文件物理地址), 其中的数据行组成单向链表, 由小到大排序
- 每个数据页都包含一个<mark class="hltr-pink">页目录</mark>, 分散存储到不同的页目录的槽位(根据主键二分查找)

![[Pasted image 20221108140919.png|300]]

| -       | -                            |
| ------- | ---------------------------- |
| fh      | 页通用信息                   |
| ph      | 数据页专有信息               |
| in + su | 最小最大虚拟行记录           |
| ur      | 实际用户记录                 |
| fs      | 空闲空间                     |
| pd      | 页目录, 页中某些记录相对位置 |
| ft      | 文件尾, 校验完整性           |

## 页中存储的记录

![[Pasted image 20221108142401.png|555]]
- 逆序排放的变长字段长度列表
- 逆序排放的null值列表, 可以为空的字段都会有一个二进制标识位1为空, 0非空

### 头信息  

|  -             |  -                                             |
|:---------------|:-----------------------------------------------|
|  delete_mask   |  是否被删除                                         |
|  min_rec_mask  |  每层非叶子节点中的最小记录标记                               |
|  n_owned       |  当前记录拥有的记录数                                    |
|  heap_no       |  当前记录在记录堆中的位置信息                                |
|  record_type   |              0: 普通, 1: b+树非叶子节点, 2: 最小, 3: 最大  |
|  next_record   |  下一条记录相对位置                                     |  

![[Pasted image 20221108143508.png|555]]
- 系统会自动生成heap_no = 0和1的最小最大记录, 存储在页的infimum + Supremue

### 行溢出
- 一个数据页是16kb = 16000byte
- 如果一行的一个字段是varchar(65535), 超过一个数据页的大小
- 就会在这行数据存储一部分然后有一个20位的指针指向其他数据页存储剩余部分

## Page Directory 页目录

[[3-页目录]]

## 页分裂

- 数据页双向链表, 自定主键不一定上一个数据页插入的行的主键一定小于下一个数据页的主键
- 但是数据页链表必然要按主键排序, 不停地插入记录, 新增一个个数据页的时候
- 会发生页分裂, 重排序
