# compact

![[Pasted image 20221108114853.png|500]]

## 记录额外信息

& 变长字段长度列表

变长字段包含 = 真正的数据内容 + 占用的字节数, 各变长字段长度以逆序排在变长字段长度列表

- W表示存储一个字符使用的字节数, utf-8做多使用3, W = 3
- 对于varchar(M), M表示该字段最多存储M个字符, 所以最多存储的字节数是W x M
- 真实存储占用的字节数是L
   - 对于M x W <= 255, 使用一个字节
   - 对于M x W > 255
      - L <= 127使用1个字节
      - L > 127使用2个字节

> 总结一下就是说：如果该可变字段允许存储的最大字节数（`M×W`）超过255字节并且真实存储的字节数（`L`）超过127字节，则使用2个字节，否则使用1个字节。

& NULL值列表

![[Pasted image 20221108120839.png]]

逆序按二进制位排, 值为null为1, 非null为0

& 记录头信息

![[Pasted image 20221108121210.png]]



## 记录的真实数据

& mysql会自动添加隐藏列

| -              | -     | -                                              |
| -------------- | ----- | ---------------------------------------------- |
| row_id         | 6字节 | 行id, 唯一标识, 如果没有自定义主键和unique索引 |
| transaction_id |   6字节    |       事务id                                         |
| roll_pointer   | 7字节 | 回滚指针                                               |

![[Pasted image 20221108121716.png]]
- ascii字符集, 所以61616161, c1列代表aaaa
- c3列属性char(10), cc是6363, 但是定长还是占用10个字节, 用空格字符20填充
- 第2条c3是空, 所以null值列表为0b100 = 06

## 一条记录的结构

![[Pasted image 20221108142239.png]]

