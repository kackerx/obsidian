:::::::::::::::::::::::::::::::::::::::: {.columns shadow=off border=off col-count=2 largest-column=firs}

~~~ad-primary
title: 最大努力通知

- 适用于最终一致性时间敏感度较低场景, 事务消费方的处理结果不会影响主动方的处理结果
- 如支付成功后, 支付平台异步通知商户结果
~~~

</br>

~~~ad-inf
title: 服务模式

- 可查询操作
- 幂等操作
1. 支付服务支付成功后, 阶梯式的通知账户服务的接口, 账户服务需要幂等
2. 如果重试到了最大次数没成功, 支付服务需提供查询支付结果的接口, 以供账户服务恢复丢失的业务
~~~

</br>

~~~ad-warn
title: 流程

- 业务主动方完成处理后, 向被动方发送消息通知, 允许消息丢失
- 实现上, 主动方可设置时间阶梯型通知规则, 消息通知失败后, 阶梯型达到最大通知次数
- 主动方需提供查询接口, 用于被动方恢复丢失的消息
~~~

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::columnbreak
:::

![[Pasted image 20240701165217.png|666]]

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

---
:::::::::::::::::::::::::::::::::::::::: {.columns shadow=off border=off col-count=2 largest-column=firs}

~~~ad-tips
title: 最大努力通知 & 可靠消息最终一致性 区别

- 设计不同: 可靠消息最终一致性确保的是消息一定发送成功, 最大努力通知则是主动方尽最大努力将消息给被动方, 消息可能丢失, 被动方不一定收得到
- 业务场景不同: 可靠消息最终一致性适合时间敏感的场景, 异步的方式达到最终一致, 『最大努力通知』则只需将处理结果通知出去
- 解决的问题不同: 『可靠消息最终一致性』是消息主动方发出, 到被动方接收的最终一致, 『最大努力通知』虽然无法确保消息从主动方发出到被动方接收的一致性, 但提供消息接收的可靠性(指被动方能够主动查询主动方的消息回查接口, 恢复丢失的业务)

~~~

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::columnbreak
:::



::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
