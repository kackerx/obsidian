# Paxos二阶段提交

## Prepare
````col
```col-md
![[Pasted image 20230410104805.png]]
- 第一阶段的准备请求是不需要指定提议值的, 只携带提议编号
```

```col-md
![[Pasted image 20230410105054.png]]
- AB节点首先响应提案编号1, C节点响应提案编号5
- 由于之前没有通过任何提案, 所以返回一个<mark style="background: #FFB8EBA6;">尚无提案</mark>响应
- 也是说告诉提议者, 之前未通过任何提案, 且承诺不再响应提案编号小于当前收到编号的请求
```

```col-md
![[Pasted image 20230410105421.png]]
- C后续收到提案编号1的请求, 但是之前已经收到提案5, 所以丢弃1
- AB收到提案编号5的请求, 返回一个准备响应尚无提案
```
````

## Accept
````col
```col-md
![[Pasted image 20230410105911.png]]
- 第二阶段客户端12收到大多数节点的准备响应后, 分别发送接受请求
- 客户端1收到大多数接受者(AB)的准备响应后, 根据响应中提案编号最大的提案值来设置接受请求的值进行发送
- AB的准备响应都是尚无提案, 所以把自己的提议值3作为接受请求的值
```

```col-md
![[Pasted image 20230410110527.png]]
- 节点ABC收到接受请求[1, 3]由于提案编号<Prepare阶段的承诺, 丢弃
- 节点ABC收到接受请求[5, 7], 达成共识, 通知别的学习者接受共识
```
````

## ov
- 本质来说, Paxos通过二阶段提交的方式达成共识, 且满足<mark style="background: #FFB8EBA6;">大多数节点同意原则</mark>
- 提案编号代表优先级, 准备请求的提案编号 <= 接受请求的提案编号, 承诺不响应这个准备请求
- 接受请求中的提案编号 < 接受者已经响应的准备请求的提案编号, 接受者承诺不通过这个提案
- 接受者之前已有通过提案, 承诺准备请求的响应中, <mark style="background: #FFB8EBA6;">包含已经通过的最大编号的提案</mark>
