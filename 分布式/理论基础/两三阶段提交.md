# 两/三阶段提交 #z 

## 2pc

### sumup

![[Pasted image 20221102230723.png|1000]]

- 库存服务和通知服务分别开启事务, 执行操作(准备阶段)
- 调用方确认扣减和确认通知
- 库存服务和通知服务分别commit(确认阶段)
- 如果调用方失败: 回滚库存和通知服务, 他们分别回滚自己的本地事务



### 缺点

- 性能差, 参与者和协调者有锁, 所有节点准备完毕协调者才会通知全局提交
- 单节点故障, 
    - 协调者故障, 参与者会一致阻塞
    - 协调者正常, 参与者故障, 协调者无法收到所有参与者的反馈, 阻塞: ==使用超时机制, 超时宣告事务失败, 回滚==