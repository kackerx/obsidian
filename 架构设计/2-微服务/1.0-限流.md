# 限流

## 计数器
````col
```col-md
~~~ad-tips
- 变量count++
- 固定时间间隔内, count > upper_limit, 拒绝请求
- 大于upper_limit, 重置count
- 有个问题是, 一分钟的最后一秒的后半秒和下一分钟前半秒同事
~~~
```

![[Pasted image 20230510100620.png|700]]
````

## 滑动窗口
````col
```col-md
~~~ad-tips
- 一个窗口1min, 划分6个格子, 每个格子10s
- 每个格子独立的计数器
- 判断时把所有格子加起来比较
~~~
```

![[Pasted image 20230510112156.png|700]]
````

## 漏桶
````col
```col-md
~~~ad-tips
- 固定容量, 出水速率固定常量
- 限制的是平均流出速度, 无法应对突发流量
~~~
```

![[Pasted image 20230510112726.png|700]]
````

## 令牌桶
````col
```col-md
~~~ad-tips
- 每个请求从桶里获取一个令牌, 桶空时阻塞或失败
- 限制的是平均流入速度, 允许一定突发流量, 只要有token就行
- 固定速率生成令牌
~~~
```

![[Pasted image 20230510113142.png|700]]
````
