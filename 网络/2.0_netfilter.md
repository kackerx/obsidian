![[Pasted image 20231219145106.png]]
## netfilter框架: linux内核处理数据包

:::::::::::::::::::::::::::::::::::::::: {.columns shadow=off border=off col-count=2 largest-column=firs}

![[Pasted image 20231219150254.png|777]]

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::columnbreak
:::

![[Pasted image 20231219145759.png|777]]

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

## 五个钩子

:::::::::::::::::::::::::::::::::::::::: {.columns shadow=off border=off col-count=2 largest-column=firs}

1. 最先到达的hook是prerouting, 如果埋了这个钩子函数, 将在这里进行『DNAT』
	1. 通过查本地路由表route, 决定数据包发送本地进程还是其他机器
	2. 发送其他机器就会走『FORWARD』hook, 发送到协议栈外的包会走『POSTROUTING』可以在这里坐『SNAT』
2. 发给本地进程的经过『INPUT』hook, 回程报文经过『OUTPUT』hook经过一次路由决策ROUTE, 要出协议栈的包走POSTROUTING

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::columnbreak
:::

![[Pasted image 20240131110848.png|666]]

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

