# tun/tap设备

:::::::::::::::::::::::::::::::::::::::: {.columns shadow=off border=off col-count=2 largest-column=firs}

1. 如图1, 经典的物理网卡eth0接收数据送到协议栈, 进程通过socket读取数据, eth0 --> stack <- socket
2. 如图2, tun/tap和物理网卡并无区别, 不同在于读取数据不是从物理链路, 而是来自用户态, 通过设备文件/dev/tunX收发数据包
3. 内核发送数据包给tun设备, 用户态的进程读取/dev/tunX获取数据, 也可以通过用户态写入这个文件向tun设备发送数据
4. tun(tun设备的/dev/tunX)收发的是IP包工作在L3, tap(tap设备的/dev/tapX)收发的是链路层的数据包, 可以与物理网卡桥接

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::columnbreak
:::

![[Pasted image 20240130190900.png|444]]

![[Pasted image 20240130190924.png|444]]

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

## VPN

:::::::::::::::::::::::::::::::::::::::: {.columns shadow=off border=off col-count=2 largest-column=firs}

1. 用户态应用程序通过socket编程发送数据包经过网络协议栈到达tun0设备
2. tun0设备一头连着协议栈一头连着用户态应用程序app2, stack --> tun0 --> app
3. app2封包后通过协议栈发送到物理网卡eth0

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::columnbreak
:::

![[Pasted image 20240131104140.png|666]]

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
